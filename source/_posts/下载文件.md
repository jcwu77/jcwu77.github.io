---
title: 下载文件到本地
date: 2019-06-19 18:29:31
tags:
---

## 一、HTML5 原生 download 属性

实现方法：`<a href="large.jpg" download>下载</a>`
缺点：

- 兼容差，目前只兼容了 Chrome
- 文件需要是同源的，跨域资源会使 download 属性失效

---

## 二、使用 Blob 实现文件下载

**接口请求设置`responseType: blob`来使得返参为 blob 类型**
实现方法：

```javascript
download = (content, filename) => {
  const eleLink = document.createElement("a");
  eleLink.download = filename; // 文件名
  eleLink.style.display = "none";
  var blob = new Blob([content]); // Blob二进制转换
  eleLink.href = URL.createObjectURL(blob); // 二进制路径转换
  // 触发点击
  document.body.appendChild(eleLink);
  eleLink.click();
  // 然后移除
  document.body.removeChild(eleLink);
};
```

## 三、生成截图并保存

1.主要使用 html2canvas 库和 canvas2img 库。
html2canvas(可通过 npm 安装):

- 文档地址：<a href="http://html2canvas.hertzen.com/" target="_blank">http://html2canvas.hertzen.com/</a>
- github 地址：<a href="https://github.com/niklasvh/html2canvas" target="_blank">https://github.com/niklasvh/html2canvas</a>

canvas2img(直接 copy 源码至项目):

- github 地址：<a href="https://github.com/hongru/canvas2image" target="_blank">https://github.com/hongru/canvas2image</a>

  2.使用方法

```javascript
html2canvas(document.getElementById("view"), {
  // 这里是相应的配置，具体配置参考文档
  useCORS: true // 是否支持跨域
}).then(canvas => {
  // canvas参数即为canvas
  const img = Canvas2Image.convertToImage(canvas);

  // 下载，兼容性不好，只支持Chrome
  document.body.appendChild(img);

  var a = document.createElement("a");
  // 创建一个单击事件
  var event = new MouseEvent("click");

  // 将a的download属性设置为想要下载的图片名称
  a.download = "截图";
  a.href = img.src; //将img的src值设置为a.href属性，img.src为base64编码值

  // 触发a的单击事件
  a.dispatchEvent(event);

  // width: 300,
  // height: 300,
});
```

**注意：**
如果出现截图不完整，偏移等情况，可设置 setTimeout 解决
