---
title: 移动端支付
date: 2019-08-01 14:26:40
tags:
---

## 微信公众号支付

有 2 种方式，推荐使用微信浏览器内置对象 WeixinJSBridge 来进行支付。

```javascript
function onBridgeReady() {
  // data为后台返参数据
  window.WeixinJSBridge.invoke(
    "getBrandWCPayRequest",
    {
      appId: data.appId,
      timeStamp: data.timeStamp,
      nonceStr: data.nonceStr,
      package: data.packageValue,
      signType: data.signType,
      paySign: data.sign
    },
    function(response) {
      if (
        response.err_msg === "get_brand_wcpay_request：ok" ||
        response.err_msg.search("ok") !== -1
      ) {
        // 支付成功的回调
      } else {
        // 支付失败的回调
      }
    }
  );
}
if (typeof window.WeixinJSBridge == "undefined") {
  if (document.addEventListener) {
    document.addEventListener("WeixinJSBridgeReady", onBridgeReady, false);
  } else if (document.attachEvent) {
    document.attachEvent("WeixinJSBridgeReady", onBridgeReady);
    document.attachEvent("onWeixinJSBridgeReady", onBridgeReady);
  }
} else {
  onBridgeReady();
}
```

---

## 微信 h5 支付

功能主要由后台来实现，后台会返回一个链接，前台只需调用接口即可，成功和失败的回调由后端进行配置

---

## 支付宝支付

接口会返回一个 form 表单类似下图所示，前端只需提交这个表单即可，成功和失败的回调由后端进行配置

![formImg](/../image/form.png "form表单图")

- 方法一：

```javascript
window.document.write(payRes); //payRes即为form表单
```

- 方法二：

```javascript
const div = document.createElement("div"); // 创建div
div.innerHTML = payRes; // 将返回的form 放入div
document.body.appendChild(div);
document.forms[0].submit();
```

---

---

## 注意事项

- 微信 h5 支付和公众号支付均需要在公众平台开通支付功能

- 配置公众号支付路由时，需要将一个认证文件放到项目根目录的 public 文件夹中，认证文件有产品提供

- 只需将正式服和测试服域名进行配置，以/结尾，不需要单独将要支付的页面路由进行单独配置，如下图所示即可
  ![wechatPay](/../image/jspay.png "微星支付配置")
