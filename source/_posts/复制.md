---
title: 复制
date: 2019-06-20 09:53:03
tags:
---

## 使用`document.execCommand("Copy");`来实现把复制的内容复制到粘贴板

---

### 思路

- 创建 input 框，value 值为需要复制的内容，设置 readonly="readonly"禁止唤起键盘
- 使用 getElementById 获取 input 框
- 调用.select()方法选中 input 框的内容（ios 中.select 方法无效）
- 最后调用 document.execCommand("Copy") 实现复制

---

### 具体代码（最初版）

html:
`<input value="copy的内容" id="copy" readonly="readonly" style={{ position: 'absolute', opacity: '0', height: '0', }} />`

js（只适合安卓端）:

```javascript
const urlLink = document.getElementById("copy");
urlLink.select();
document.execCommand("copy");
message.success("分享链接已复制成功！", 1);
```

---

### 遇到的问题及解决方案

1. 如果不想显示 input 框，可以将 input 框的 opacity 属性设置为 0，在使用绝对定位使其脱离文档流。注意，**不能将 input 框的 display 属性设置为 none 或将 visibility 设置为 hidden 或设置 disabled，这会导致复制失败**

2. ie 之外的浏览器 document.execCommand("copy");这个必须在**由用户操作触发的点击事件线程中执行**，在 axios 异步的回调函数中执行是不允许的。解决的方案是使用 async 和 await，将异步的操作变为同步即可

3. ios 中无法使用.select()方法选中文字，需要重写选中文字的方法

```javascript
selectText = (textbox, startIndex, stopIndex) => {
  if (textbox.createTextRange) {
    //ie
    const range = textbox.createTextRange();
    range.collapse(true);
    range.moveStart("character", startIndex); //起始光标
    range.moveEnd("character", stopIndex - startIndex); //结束光标
    range.select(); //不兼容苹果
  } else {
    //firefox/chrome
    textbox.setSelectionRange(startIndex, stopIndex);
    textbox.focus();
  }
};
```

---

### 具体代码（最终版，兼容双端）

```javascript
let urlLink = document.getElementById("urlCopy");
this.selectText(urlLink, 0, url.length);
console.log(document.execCommand("copy"), "execCommand");
document.execCommand("Copy");
urlLink.blur();
```

---

---

## 使用 react-copy-to-clipboard 插件实现

文档地址： <https://github.com/nkbt/react-copy-to-clipboard/>

具体代码

```javascript
import { CopyToClipboard } from "react-copy-to-clipboard";
<CopyToClipboard
  text={this.state.value}
  onCopy={() => this.setState({ copied: true })}
>
  <span>Copy to clipboard with span</span>
</CopyToClipboard>;
```
